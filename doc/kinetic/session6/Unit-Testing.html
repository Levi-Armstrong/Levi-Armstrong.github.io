

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Unit Testing &mdash; SphinxTest 1.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="SphinxTest 1.0 documentation" href="../../../index.html"/>
        <link rel="next" title="Using rqt Tools for Analysis" href="Using-rqt-tools-for-analysis.html"/>
        <link rel="prev" title="Documentation Generation" href="Documentation-Generation.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> SphinxTest
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../setup/PC-Setup---ROS-Kinetic.html">PC Setup</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference external" href="http://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-096-introduction-to-c-january-iap-2011/assignments/">MIT Introduction to C++</a></li>
<li class="toctree-l1"><a class="reference external" href="http://mindview.net/Books/TICPP/ThinkingInCPP2e.html">Bruce Eckel Thinking in C++</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../prerequisites/Navigating-the-Ubuntu-GUI.html">Exercise 0.1 - Intro to Ubuntu GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prerequisites/Exploring-the-Linux-File-System.html">Exercise 0.2 - The Linux File System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prerequisites/The-Linux-Terminal.html">Exercise 0.3 - Using the Terminal</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../session1/ROS-Setup.html">Exercise 1.0 - ROS Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session1/Create-Catkin-Workspace.html">Exercise 1.1 - Create a Workspace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session1/Installing-Existing-Packages.html">Exercise 1.2 - Installing Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session1/Creating-a-ROS-Package-and-Node.html">Exercise 1.3 - Packages and Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session1/Topics-and-Messages.html">Exercise 1.4 - Topics and Messages</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../session2/Services.html">Exercise 2.0 - Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session2/Actions.html">Exercise 2.1 - Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session2/Launch-Files.html">Exercise 2.2 - Launch Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session2/Parameters.html">Exercise 2.3 - Parameters</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../session3/Intro-to-URDF.html">Exercise 3.0 - Intro to URDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session3/Workcell-XACRO.html">Exercise 3.1 - Workcell XACRO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session3/Coordinate-Transforms-using-TF.html">Exercise 3.2 - Transforms using TF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session3/Build-a-Moveit!-Package.html">Exercise 3.3 - Build a MoveIt! Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session3/Motion-Planning-RVIZ.html">Exercise 3.4 - Motion Planning using RViz</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../session4/Motion-Planning-CPP.html">Exercise 4.0 - Motion Planning using C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session4/Descartes-Path-Planning.html">Exercise 4.1 - Intro to Descartes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session4/Introduction-to-Perception.html">Exercise 4.2 - Intro to Perception</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../demo1/Introduction.html">Demo 1.0 - Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo1/Inspect-the-package.html">Demo 1.1 - Inspect the &quot;pick_and_place_exercise&quot; Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo1/Package-Setup.html">Demo 1.2 - Package Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo1/Bring-up-ROS-system-in-simulation-mode.html">Demo 1.3 - Start in Simulation Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo1/Initialization-and-global-variables.html">Demo 1.4 - Initialization and Global Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo1/Move-arm-to-wait-position.html">Demo 1.5 - Move Arm to Wait Position</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo1/Open-gripper.html">Demo 1.6 - Open Gripper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo1/Detect-box-pick-point.html">Demo 1.7 - Detect Box Pick Point</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo1/Create-pick-moves.html">Demo 1.8 - Create Pick Moves</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo1/Pick-up-box.html">Demo 1.9 - Pick Up Box</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo1/Create-place-moves.html">Demo 1.10 - Create Place Moves</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo1/Place-box.html">Demo 1.11 - Place Box</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../demo2/Introduction.html">Demo 2.0 - Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo2/Application-Structure.html">Demo 2.1 - Application Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo2/General-Instructions.html">Demo 2.2 - General Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo2/Load-Parameters.html">Demo 2.3 - Load Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo2/Initialize-ROS.html">Demo 2.4 - Initialize ROS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo2/Initialize-Descartes.html">Demo 2.5 - Initialize Descartes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo2/Move-Home.html">Demo 2.6 - Move Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo2/Generate-a-Semi-Constrained-Trajectory.html">Demo 2.7 - Generate a Semi-Constrained Trajectory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo2/Plan-a-robot-path.html">Demo 2.8 - Plan a Robot Path</a></li>
<li class="toctree-l1"><a class="reference internal" href="../demo2/Run-a-robot-path.html">Demo 2.9 - Run a Robot Path</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../session5/Advanced-Descartes-Path-Planning.html">Exercise 5.0 - Advanced Descartes Path Planning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session5/Building-a-Perception-Pipeline.html">Exercise 5.1 - Building a Perception Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session5/Introduction-to-STOMP.html">Exercise 5.2 - Introduction to STOMP</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Documentation-Generation.html">Exercise 6.0 - Documentation Generation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Exercise 6.1 - Unit Testion</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#motivation">Motivation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#information-and-resources">Information and Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="#scan-n-plan-application-problem-statement">Scan-N-Plan Application: Problem Statement</a></li>
<li class="toctree-l2"><a class="reference internal" href="#scan-n-plan-application-guidance">Scan-N-Plan Application: Guidance</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#create-the-unit-test-frame-work">Create the unit test frame work</a></li>
<li class="toctree-l3"><a class="reference internal" href="#write-the-unit-tests">Write the unit tests</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Using-rqt-tools-for-analysis.html">Exercise 6.2 - Using rqt tools for Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="Style-Guide-and-ros_lint.html">Exercise 6.3 - ROS Style Guide and ros_lint</a></li>
<li class="toctree-l1"><a class="reference internal" href="Docker-AWS.html">Exercise 6.4 - Introduction to ROS with Docker and Amazon Web Services (AWS)</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">SphinxTest</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
    <li>Unit Testing</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/doc/kinetic/session6/Unit-Testing.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="unit-testing">
<span id="unit-testing"></span><h1>Unit Testing<a class="headerlink" href="#unit-testing" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div>In this exercise we will write a unit tests in the myworkcell_core package.</div></blockquote>
<div class="section" id="motivation">
<span id="motivation"></span><h2>Motivation<a class="headerlink" href="#motivation" title="Permalink to this headline">¶</a></h2>
<p>The ROS Scan-N-Plan application is complete and documented.  Now we want to test the program to make sure it behaves as expected.</p>
</div>
<div class="section" id="information-and-resources">
<span id="information-and-resources"></span><h2>Information and Resources<a class="headerlink" href="#information-and-resources" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/google/googletest">Google Test</a>: C++ XUnit test framework</p>
<p><a class="reference external" href="http://wiki.ros.org/rostest">rostest</a>: ROS wrapper for XUnit test framework</p>
<p><a class="reference external" href="http://catkin-tools.readthedocs.io/en/latest/verbs/catkin_build.html?highlight=run_tests#building-and-running-tests">catkin testing</a>: Building and running tests with catkin</p>
</div>
<div class="section" id="scan-n-plan-application-problem-statement">
<span id="scan-n-plan-application-problem-statement"></span><h2>Scan-N-Plan Application: Problem Statement<a class="headerlink" href="#scan-n-plan-application-problem-statement" title="Permalink to this headline">¶</a></h2>
<p>We have completed and and documented our Scan-N-Plan program.  We need to create a test framework so we can be sure our program runs as intended after it is built. In addition to ensuring the code runs as intended, unit tests allow you to easily check if new code changes functionality in unexpected ways.  Your goal is to create the unit test frame work and write a few tests.</p>
</div>
<div class="section" id="scan-n-plan-application-guidance">
<span id="scan-n-plan-application-guidance"></span><h2>Scan-N-Plan Application: Guidance<a class="headerlink" href="#scan-n-plan-application-guidance" title="Permalink to this headline">¶</a></h2>
<div class="section" id="create-the-unit-test-frame-work">
<span id="create-the-unit-test-frame-work"></span><h3>Create the unit test frame work<a class="headerlink" href="#create-the-unit-test-frame-work" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li>Create a <code class="docutils literal"><span class="pre">test</span></code> folder in the myworkcell_core/src folder. In the workspace directory:</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">catkin</span> <span class="n">build</span>
<span class="n">source</span> <span class="n">devel</span><span class="o">/</span><span class="n">setup</span><span class="o">.</span><span class="n">bash</span>
<span class="n">roscd</span> <span class="n">myworkcell_core</span>
<span class="n">mkdir</span> <span class="n">src</span><span class="o">/</span><span class="n">test</span>
</pre></div>
</div>
<ol class="simple">
<li>Create utest.cpp file in the <code class="docutils literal"><span class="pre">myworkcell_core/src/test</span></code> folder:</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">touch</span> <span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">utest</span><span class="o">.</span><span class="n">cpp</span>
</pre></div>
</div>
<ol class="simple">
<li>Open utest.cpp in QT and include ros &amp; gtest:</li>
</ol>
<div class="highlight-c++"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ros/ros.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;gtest/gtest.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<ol class="simple">
<li>Write a dummy test that will return true if executed. This will test our framework and we will replace it later with more useful tests:</li>
</ol>
<div class="highlight-c++"><div class="highlight"><pre><span></span><span class="n">TEST</span><span class="p">(</span><span class="n">TestSuite</span><span class="p">,</span> <span class="n">myworkcell_core_framework</span><span class="p">){</span>
  <span class="n">ASSERT</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<ol class="simple">
<li>Next include the general main function, which will execute the unit tests we write later:</li>
</ol>
<div class="highlight-c++"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">){</span>
  <span class="n">testing</span><span class="o">::</span><span class="n">InitGoogleTest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">RUN_ALL_TESTS</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<ol class="simple">
<li>Edit myworkcell_core CMakeLists.txt to build the u_test.cpp file.  Append CMakeLists.txt:</li>
</ol>
<div class="highlight-cmake"><div class="highlight"><pre><span></span><span class="nb">if</span><span class="p">(</span><span class="s">CATKIN_ENABLE_TESTING</span><span class="p">)</span>
  <span class="nb">find_package</span><span class="p">(</span><span class="s">rostest</span> <span class="s">REQUIRED</span><span class="p">)</span>
  <span class="nb">add_rostest_gtest</span><span class="p">(</span><span class="s">utest_node</span> <span class="s">test/utest_launch.test</span> <span class="s">src/test/utest.cpp</span><span class="p">)</span>
  <span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">utest_node</span> <span class="o">${</span><span class="nv">catkin_LIBRARIES</span><span class="o">}</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>
</pre></div>
</div>
<ol class="simple">
<li>Create a test folder under myworkcell_core</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">test</span>
</pre></div>
</div>
<ol class="simple">
<li>Create a test launch file:</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">touch</span> <span class="n">test</span><span class="o">/</span><span class="n">utest_launch</span><span class="o">.</span><span class="n">test</span>
</pre></div>
</div>
<ol class="simple">
<li>Open the utest_launch.test file in QT and populate the file:</li>
</ol>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;launch&gt;</span>
  <span class="nt">&lt;test</span> <span class="na">test-name=</span><span class="s">&quot;unit_test_node&quot;</span> <span class="na">pkg=</span><span class="s">&quot;myworkcell_core&quot;</span> <span class="na">type=</span><span class="s">&quot;utest_node&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></div>
</div>
<ol class="simple">
<li>Test the framework</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">catkin</span> <span class="n">build</span>
<span class="n">catkin</span> <span class="n">run_tests</span>
</pre></div>
</div>
<p>The console output should show:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">ROSTEST</span><span class="p">]</span><span class="o">-----------------------------------------------------------------------</span>

<span class="p">[</span><span class="n">myworkcell_core</span><span class="o">.</span><span class="n">rosunit</span><span class="o">-</span><span class="n">unit_test_node</span><span class="o">/</span><span class="n">myworkcell_core_framework</span><span class="p">][</span><span class="n">passed</span><span class="p">]</span>

<span class="n">SUMMARY</span>
 <span class="o">*</span> <span class="n">RESULT</span><span class="p">:</span> <span class="n">SUCCESS</span>
 <span class="o">*</span> <span class="n">TESTS</span><span class="p">:</span> <span class="mi">1</span>
 <span class="o">*</span> <span class="n">ERRORS</span><span class="p">:</span> <span class="mi">0</span>
 <span class="o">*</span> <span class="n">FAILURES</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>This means our framework is functional and now we can add usefull unit tests.</p>
</div>
<div class="section" id="write-the-unit-tests">
<span id="write-the-unit-tests"></span><h3>Write the unit tests<a class="headerlink" href="#write-the-unit-tests" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li>Since we will be testing the messages we get from the fake_ar_publisher package, include the relevant header file:</li>
</ol>
<div class="highlight-c++"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;fake_ar_publisher/ARMarker.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<ol class="simple">
<li>Declare a global variable:</li>
</ol>
<div class="highlight-c++"><div class="highlight"><pre><span></span><span class="n">fake_ar_publisher</span><span class="o">::</span><span class="n">ARMarkerConstPtr</span> <span class="n">test_msg_</span><span class="p">;</span>
</pre></div>
</div>
<ol class="simple">
<li>Write a unit test to check the reference frame of the ar_pose_marker:</li>
</ol>
<div class="highlight-c++"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<ol class="simple">
<li>Run the test:</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">catkin</span> <span class="n">build</span>
<span class="n">rostest</span> <span class="n">myworkcell_core</span> <span class="n">utest_launch</span><span class="o">.</span><span class="n">test</span>
</pre></div>
</div>
<ol class="simple">
<li>view the results of the test:</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">catkin_test_results</span> <span class="n">build</span><span class="o">/</span><span class="n">myworkcell_core</span>
</pre></div>
</div>
<p>You should see:
Summary: 2 tests, 0 errors, 0 failures</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Using-rqt-tools-for-analysis.html" class="btn btn-neutral float-right" title="Using rqt Tools for Analysis" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Documentation-Generation.html" class="btn btn-neutral" title="Documentation Generation" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Levi Armstrong.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>